<%- include('../partials/header') %>
<main>
  <div class="container d-flex flex-column align-items-center mt-5 gap-3">
    <h1>Ini adalah halaman Master</h1>
    <button type="button" class="btn btn-primary" onclick="startQuiz()">
      Start Quiz!
    </button>

    <div class="w-100 mt-3">
      <h2 class="text-center">List Team</h2>
      <div id="list-tim" class="row g-3 justify-content-center">
        <!-- Tim akan ditampilkan di sini -->
      </div>
    </div>
  </div>
</main>

<script>
  const socket = io("http://192.168.88.29:3000", {
    query: {
      userId: "admin123", // ID tetap
      role: "admin",
    },
  });

  // Menghapus tim saat keluar
  socket.on("TeamLeave", (namatim) => {
    console.log(`${namatim} left`);
    const listTim = document.getElementById("list-tim");
    const itemToRemove = Array.from(listTim.children).find(
      (div) => div.getAttribute("data-team") === namatim
    );
    if (itemToRemove) {
      listTim.removeChild(itemToRemove);
    }
  });

  socket.on("TeamJoined", (namatim) => {
    console.log(`${namatim} joined`);
    const listTim = document.getElementById("list-tim");

    // Cek apakah tim sudah ada dalam daftar
    const existingItem = Array.from(listTim.children).find(
      (div) => div.getAttribute("data-team") === namatim
    );
    if (!existingItem) {
      const div = document.createElement("div");
      div.className = "col-md-4 text-center p-2";
      div.setAttribute("data-team", namatim);
      div.innerHTML = `<div class="p-3 border rounded bg-light">${namatim}</div>`;
      listTim.appendChild(div);
    }
  });

  const startQuiz = () => {
    socket.emit("startQuiz");
  };
</script>

<%- include('../partials/footer') %>
